@using Sandbox;
@using Sandbox.Data;
@using Sandbox.UI;
@inherits PanelComponent

<root>
    <div class="sub">
        <div class="panel">
            @if(info != null)
            {
                <style>
                    .sub{
                        width:1600px;
                    }
                </style>
                <div class="mapinfo" style="@("background-image: url(" + info.Img + ")")">
                    <div class="header ">
                        <div class="text">
                            <div class="name">@info.Name</div>
                            @if(info.Scores.Count() != 0)
                            {
                                <div class="btime">Best Time: @Sng.Inst.FormatTime(info.Scores[0].Time)
                                </div>
                            }
                            else
                            {
                                <div class="btime">Not Played</div>
                            }
                            @if(info.Author != null || info.Author != "")
                            {
                                <div class="author">By: @info.Author</div>
                            }
                            @if(info.DifficultyTier != 0)
                            {
                                <div class="difficulty">Tier: @info.DifficultyTier</div>
                            }
                            
                        </div>
                        <img class="medal" src="@("img/medal"+(MenuC.GetMedal(info)).ToString()+".png")"/>
                    </div>
                    <div class="gradi"></div>
                    <div class="bot" >
                        <div class="play" 
                            onclick="@(x => Sng.Inst.File.DownloadAndLoad(info.Indent))">
                            <p>
                                PLAY
                            </p>
                        </div>
                    </div>
                </div>
            }
            <div class="left">
                <div class="up">
                    Official
                </div>
                <div class="down">
                    @for (int i = 0; i < Official.Count(); i++)
                    {
                        var m = Official[i];
                        <div class="list-item dark" 
                        onclick="@(x => {ShowInfo(m, "official");})"
                        style="@("background-image: url(" + Official[i].Img + ")")">
                            <div class="time" >@(Official[i].Name.ToUpper())</div>
                        </div>
                    }
                </div>
            </div>
            <div class="center">
                <div class="up">
                    Featured
                </div>
                <div class="down">
                    @for (int i = 0; i < Featured.Count(); i++)
                    {
                        var m = Featured[i];
                        <div class="list-item dark"
                             onclick="@(x => {ShowInfo(m, "featured");})"
                             style="@("background-image: url(" + Featured[i].Img + ")")">
                            <div class="time">@(Featured[i].Name.ToUpper())</div>
                        </div>
                    } 
                    <div class="add" onclick="@Copy">
                        @if (copied)
                        {
                            <p>
                                Copied to clipboard
                            </p>
                        }
                        else
                        {
                            <p>
                                Join the Discord
                            </p>
                            <p>
                                to create maps
                            </p>
                        }
                    </div>
                </div>
            </div>
            <div class="right">
                <div class="up">
                    Community
                </div>
                <div class="down">


                    @for (int i = 0; i < Community.Count(); i++)
                    {
                        var m = Community[i];
                        <div class="list-item dark"
                             onclick="@(x => {ShowInfo(m, "community");})"
                             style="@("background-image: url(" + Community[i].Img + ")")">
                            <div class="time">@(Community[i].Name.ToUpper())</div>
                        </div>
                    }
                    

                    <div class="add" onclick="@MenuC.MapSelect">Find</div>
                </div>
            </div>
        </div>
        <div class="bk">
            <div class="back" onclick="@CloseMenu">
                <div class="text">Back</div>
                <div class="bg" onclick="@CloseMenu"></div>
            </div>
        </div>
    </div>
</root>

@code
{
    MenuController MenuC { get; set; }
    public List<MapData> Official { get; set; } = new List<MapData>();
    public List<MapData> Featured { get; set; }= new List<MapData>();
    public List<MapData> Community { get; set; }= new List<MapData>();
    public MapData info = null;
    public bool copied = false;

    public void Copy()
    {
        copied = true;
        MenuC.Copy();
    }
    public void ShowInfo(MapData i, string type)
    {
        var list = type == "official" ? Official : type == "featured" ? Featured : Community;
        info = i;
    }

    void CloseMenu()
    {
        MenuC.CloseChooseMenu();
        info=null;
        copied = false;
    }
    protected override void OnAwake()
    {
        base.OnAwake();
        MenuC = GameObject.Parent.Components.Get<MenuController>();
    }

    protected override int BuildHash() => System.HashCode.Combine( Official, Featured, Community , info);
}